\usepackage{xparse}

% url has the \path command, which produces inline \tt text that breaks at '/'
%\usepackage{url}
\usepackage{xstring}

% use the good mono font
\usepackage{fontspec}
%\setmonofont{DejaVu Sans Mono}
%\setmonofont{Inconsolata}
\setmonofont{Consolas}


% need colors for customizing highlighting
\usepackage[usenames]{color}

% gray background color for all code-like text
\definecolor{bg}{rgb}{.9372549, .94117647, .94509804}
\definecolor{termbg}{rgb}{.2, .2, .2}

% set a highlight color for generic code-like text (paths, exes, etc.)
\usepackage[normalem]{ulem}
\newcommand\hlcode{\bgroup\markoverwith
  {\textcolor{bg}{\rule[-.5ex]{2pt}{2.5ex}}}\ULon}

\newcommand\hlblack{\bgroup\markoverwith
  {\textcolor{termbg}{\rule[-1ex]{2pt}{3.5ex}}}\ULon}

\newcommand{\hlshell}[1]{\texttt{\small\textcolor{white}{\hlblack{#1}}}}

% minted supplies syntax highlighting for code snippets
\usepackage{minted}
\setminted{fontsize=\small} % font size for minted
\setminted[bash]{bgcolor=bg, style=native}
\setminted[console]{bgcolor=termbg, style=native}
\setminted[python]{bgcolor=bg, style=friendly}
\setminted[text]{bgcolor=bg, style=friendly}

% A text replacement macro
\def\replace#1#2#3{%
 \def\tmp##1#2{##1#3\tmp}%
   \tmp#1\stopreplace#2\stopreplace}
\def\stopreplace#1\stopreplace{}

% "No subscript" macro for escaping the underscore character.
% Use \noss when \detokenize would be overkill/screw up macros
\newcommand{\noss}[1]{\replace{#1}{_}{\_}}
\newcommand{\bs}{\allowbreak/}

% Highlight generic bits of code inline
\newcommand{\code}[1]{{\tt \hlcode{\noss{#1}}}}
\newcommand{\keyword}[1]{\code{#1}}

%\newcommand{\pth}[1]{\bslash{\texttt{\hlcode{#1}}}}
\newcommand{\pth}[1]{\code{#1}}
\newcommand{\file}[1]{\pth{#1}}
\newcommand{\exe}[1]{\pth{#1}}

% deprecated
\newcommand{\gui}[1]{\code{#1}}

% Highlight generic bits of code in math mode
\newcommand{\mcode}[1]{\text{\code{#1}}}

% Highlight code of specific language inline
\newcommand{\sh}[1]{\mintinline{bash}{#1}}
\newcommand{\py}[1]{\mintinline{python}{#1}}

% Highlight code snippets from included external files
\newmintedfile[inputcmd]{console}{formatcom=\color{white}}
\newmintedfile[inputpy]{python}{}
\newmintedfile[inputout]{text}{}
\newmintedfile[inputouttiny]{text}{fontsize=\tiny}

% Other macros
%\edef\cmdline{\noexpand\mint{bash}/$\string#/}
\newcommand{\cmdline}[2]{~\\[.75\baselineskip]\hlshell{\quad user@host:\noss{#1}\$ \noss{#2}\hfill}\\[.75\baselineskip]}
